{"remainingRequest":"/home/ash/Documents/cloudrun/second/frontend/node_modules/babel-loader/lib/index.js!/home/ash/Documents/cloudrun/second/frontend/node_modules/ts-loader/index.js??ref--14-2!/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Lists/Lists.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Lists/Lists.vue","mtime":1601935109868},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnZhbHVlcyI7CmltcG9ydCBfb2JqZWN0U3ByZWFkIGZyb20gIi9ob21lL2FzaC9Eb2N1bWVudHMvY2xvdWRydW4vc2Vjb25kL2Zyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0IHsgZGVmaW5lQ29tcG9uZW50LCBjb21wdXRlZCwgcmVmIH0gZnJvbSAnQHZ1ZS9jb21wb3NpdGlvbi1hcGknOwppbXBvcnQgTGlzdCBmcm9tICdAL2NvbXBvbmVudHMvUHJvamVjdC9MaXN0cy9MaXN0LnZ1ZSc7CmltcG9ydCB7IFdvcmtvcmRlclN0YXR1cyB9IGZyb20gJ0AvdHlwZXMvd29ya29yZGVyJzsKaW1wb3J0IHsgZ2V0dGVycywgbXV0YXRpb25zIH0gZnJvbSAnQC9zdG9yZSc7CmltcG9ydCB7IGNhbGN1bGF0ZVdvcmtvcmRlckxpc3RQb3NpdGlvbiwgaXNQb3NpdGlvbkNoYW5nZWQsIHVwZGF0ZUFycmF5SXRlbUJ5SWQgfSBmcm9tICdAL3V0aWxzL2RuZCc7CmltcG9ydCB7IHVzZU11dGF0aW9uIH0gZnJvbSAnQHZ1ZS9hcG9sbG8tY29tcG9zYWJsZSc7CmltcG9ydCB7IHVwZGF0ZVdvcmtvcmRlck11dGF0aW9uIH0gZnJvbSAnQC9ncmFwaHFsL3F1ZXJpZXMvd29ya29yZGVyJzsKZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHsKICBjb21wb25lbnRzOiB7CiAgICBMaXN0OiBMaXN0CiAgfSwKICBzZXR1cDogZnVuY3Rpb24gc2V0dXAoKSB7CiAgICB2YXIgcHJvamVjdCA9IGNvbXB1dGVkKGdldHRlcnMucHJvamVjdCk7CiAgICB2YXIgZGVzdGluYXRpb24gPSByZWYobnVsbCk7CiAgICB2YXIgc291cmNlID0gcmVmKG51bGwpOwoKICAgIHZhciBfdXNlTXV0YXRpb24gPSB1c2VNdXRhdGlvbih1cGRhdGVXb3Jrb3JkZXJNdXRhdGlvbiksCiAgICAgICAgbXV0YXRlID0gX3VzZU11dGF0aW9uLm11dGF0ZTsKCiAgICB2YXIgaGFuZGxlV29ya29yZGVyRHJvcCA9IGZ1bmN0aW9uIGhhbmRsZVdvcmtvcmRlckRyb3Aod29ya29yZGVySWQsIGQsIHMpIHsKICAgICAgaWYgKCFpc1Bvc2l0aW9uQ2hhbmdlZChzLCBkKSkgcmV0dXJuOwogICAgICB2YXIgd29ya29yZGVyVXBkYXRlVmFsdWVzID0gewogICAgICAgIHN0YXR1czogZC5kcm9wcGFibGVJZCwKICAgICAgICBsaXN0UG9zaXRpb246IGNhbGN1bGF0ZVdvcmtvcmRlckxpc3RQb3NpdGlvbihwcm9qZWN0LnZhbHVlLndvcmtvcmRlcnMsIGQsIHMsIHdvcmtvcmRlcklkKQogICAgICB9OwogICAgICB2YXIgd29ya29yZGVycyA9IHVwZGF0ZUFycmF5SXRlbUJ5SWQocHJvamVjdC52YWx1ZS53b3Jrb3JkZXJzLCB3b3Jrb3JkZXJJZCwgd29ya29yZGVyVXBkYXRlVmFsdWVzKTsKICAgICAgdmFyIG9sZFByb2plY3RWYWx1ZXMgPSBnZXR0ZXJzLnByb2plY3QoKTsgLy8gb3B0aW1pc3RpYyB1cGRhdGUKCiAgICAgIG11dGF0aW9ucy5zZXRQcm9qZWN0KF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcHJvamVjdC52YWx1ZSksIHt9LCB7CiAgICAgICAgd29ya29yZGVyczogd29ya29yZGVycwogICAgICB9KSk7CiAgICAgIG11dGF0ZSh7CiAgICAgICAgd29ya29yZGVySWQ6IE51bWJlcih3b3Jrb3JkZXJJZCksCiAgICAgICAgV29ya29yZGVyOiB3b3Jrb3JkZXJVcGRhdGVWYWx1ZXMgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCgogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgbXV0YXRpb25zLnNldFByb2plY3Qob2xkUHJvamVjdFZhbHVlcyk7CiAgICAgIH0pOwogICAgICBkZXN0aW5hdGlvbi52YWx1ZSA9IG51bGw7CiAgICAgIHNvdXJjZS52YWx1ZSA9IG51bGw7CiAgICB9OwoKICAgIHZhciBvbkRyb3AgPSBmdW5jdGlvbiBvbkRyb3AoZHJvcFJlc3VsdCkgewogICAgICB2YXIgcmVtb3ZlZEluZGV4ID0gZHJvcFJlc3VsdC5yZW1vdmVkSW5kZXgsCiAgICAgICAgICBhZGRlZEluZGV4ID0gZHJvcFJlc3VsdC5hZGRlZEluZGV4LAogICAgICAgICAgcGF5bG9hZCA9IGRyb3BSZXN1bHQucGF5bG9hZCwKICAgICAgICAgIHRvID0gZHJvcFJlc3VsdC50bzsKICAgICAgaWYgKHJlbW92ZWRJbmRleCA9PSBudWxsICYmIGFkZGVkSW5kZXggPT0gbnVsbCkgcmV0dXJuOwoKICAgICAgaWYgKHJlbW92ZWRJbmRleCAhPSBudWxsKSB7CiAgICAgICAgc291cmNlLnZhbHVlID0gewogICAgICAgICAgaW5kZXg6IHJlbW92ZWRJbmRleCwKICAgICAgICAgIGRyb3BwYWJsZUlkOiBwYXlsb2FkLnN0YXR1cwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmIChhZGRlZEluZGV4ICE9IG51bGwpIHsKICAgICAgICBkZXN0aW5hdGlvbi52YWx1ZSA9IHsKICAgICAgICAgIGluZGV4OiBhZGRlZEluZGV4LAogICAgICAgICAgZHJvcHBhYmxlSWQ6IE9iamVjdC52YWx1ZXMoV29ya29yZGVyU3RhdHVzKVt0b10KICAgICAgICB9OwogICAgICB9CgogICAgICBpZiAoZGVzdGluYXRpb24udmFsdWUgIT0gbnVsbCAmJiBzb3VyY2UudmFsdWUgIT0gbnVsbCkgewogICAgICAgIGhhbmRsZVdvcmtvcmRlckRyb3AocGF5bG9hZC5pZCwgZGVzdGluYXRpb24udmFsdWUsIHNvdXJjZS52YWx1ZSk7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgb25Ecm9wOiBvbkRyb3AsCiAgICAgIFdvcmtvcmRlclN0YXR1czogV29ya29yZGVyU3RhdHVzCiAgICB9OwogIH0KfSk7"},{"version":3,"sources":["/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Lists/Lists.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\nimport { defineComponent, computed, ref } from '@vue/composition-api'\nimport List from '@/components/Project/Lists/List.vue'\nimport { WorkorderStatus } from '@/types/workorder'\nimport { getters, mutations } from '@/store'\nimport {\n  DropResult,\n  Target,\n  calculateWorkorderListPosition,\n  isPositionChanged,\n  updateArrayItemById\n} from '@/utils/dnd'\nimport { useMutation } from '@vue/apollo-composable'\nimport { updateWorkorderMutation } from '@/graphql/queries/workorder'\n\nexport default defineComponent({\n  components: {\n    List\n  },\n  setup() {\n    const project = computed(getters.project)\n    const destination = ref<Target>(null)\n    const source = ref<Target>(null)\n\n    const { mutate } = useMutation(updateWorkorderMutation)\n\n    const handleWorkorderDrop = (workorderId: string, d: Target, s: Target) => {\n      if (!isPositionChanged(s, d)) return\n\n      const workorderUpdateValues = {\n        status: d.droppableId,\n        listPosition: calculateWorkorderListPosition(\n          project.value.workorders,\n          d,\n          s,\n          workorderId\n        )\n      }\n\n      const workorders = updateArrayItemById(\n        project.value.workorders,\n        workorderId,\n        workorderUpdateValues\n      )\n\n      const oldProjectValues = getters.project()\n      // optimistic update\n      mutations.setProject({\n        ...project.value,\n        workorders\n      })\n\n      mutate({\n        workorderId: Number(workorderId),\n        Workorder: workorderUpdateValues\n        // eslint-disable-next-line\n      } as any).catch(e => {\n        console.error(e)\n        mutations.setProject(oldProjectValues)\n      })\n      destination.value = null\n      source.value = null\n    }\n\n    const onDrop = (dropResult: DropResult) => {\n      const { removedIndex, addedIndex, payload, to } = dropResult\n\n      if (removedIndex == null && addedIndex == null) return\n\n      if (removedIndex != null) {\n        source.value = {\n          index: removedIndex,\n          droppableId: payload.status\n        }\n      }\n\n      if (addedIndex != null) {\n        destination.value = {\n          index: addedIndex,\n          droppableId: Object.values(WorkorderStatus)[to]\n        }\n      }\n\n      if (destination.value != null && source.value != null) {\n        handleWorkorderDrop(payload.id, destination.value, source.value)\n      }\n    }\n\n    return {\n      onDrop,\n      WorkorderStatus\n    }\n  }\n})\n"],"sourceRoot":""}]}