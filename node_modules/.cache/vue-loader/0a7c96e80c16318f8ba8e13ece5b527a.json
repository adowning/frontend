{"remainingRequest":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Workorder/WorkorderDetails/Comment.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Workorder/WorkorderDetails/Comment.vue","mtime":1601934218213},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgeyBkZWZpbmVDb21wb25lbnQsIGNvbXB1dGVkLCByZWYgfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaScKCmltcG9ydCB7IENvbW1lbnQgfSBmcm9tICdAL3R5cGVzL2NvbW1lbnQnCmltcG9ydCB7IGZvcm1hdERhdGVUaW1lQ29udmVyc2F0aW9uYWwgfSBmcm9tICdAL3V0aWxzL2RhdGUnCmltcG9ydCB7IHVzZU11dGF0aW9uIH0gZnJvbSAnQHZ1ZS9hcG9sbG8tY29tcG9zYWJsZScKaW1wb3J0IHsgY3JlYXRlQ29tbWVudCwgdXBkYXRlQ29tbWVudCB9IGZyb20gJ0AvZ3JhcGhxbC9xdWVyaWVzL2NvbW1lbnQnCmltcG9ydCB7IGdldHRlcnMgfSBmcm9tICdAL3N0b3JlJwoKZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHsKICBwcm9wczogewogICAgY29tbWVudDogewogICAgICB0eXBlOiBPYmplY3QgYXMgKCkgPT4gQ29tbWVudCwKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0sCiAgICBpc0NyZWF0ZTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIHJlZmV0Y2h3b3Jrb3JkZXI6IHsKICAgICAgdHlwZTogRnVuY3Rpb24sCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9CiAgfSwKICBzZXR1cChwcm9wcywgeyByb290LCBlbWl0IH0pIHsKICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gY29tcHV0ZWQoZ2V0dGVycy5jdXJyZW50VXNlcikKICAgIGNvbnN0IG5ld0NvbW1lbnQgPSByZWY8c3RyaW5nPihwcm9wcy5pc0NyZWF0ZSA/ICcnIDogcHJvcHMuY29tbWVudC5ib2R5KQogICAgY29uc3QgaXNXb3JraW5nID0gcmVmPGJvb2xlYW4+KGZhbHNlKQogICAgY29uc3QgaXNGb3JtT3BlbiA9IHJlZjxib29sZWFuPihmYWxzZSkKICAgIGNvbnN0IGlzQ29tbWVudERlbGV0ZUNvbmZpcm1PcGVuID0gcmVmPGJvb2xlYW4+KGZhbHNlKQogICAgY29uc3QgcmVhZE9ubHkgPSBjb21wdXRlZCgKICAgICAgKCkgPT4gY3VycmVudFVzZXIudmFsdWUuaWQgIT0gcHJvcHMuY29tbWVudC51c2VySWQKICAgICkKCiAgICBjb25zdCB7IG11dGF0ZTogY3JlYXRlTXV0YXRpb24gfSA9IHVzZU11dGF0aW9uKGNyZWF0ZUNvbW1lbnQpCiAgICBjb25zdCB7IG11dGF0ZTogdXBkYXRlTXV0YXRpb24gfSA9IHVzZU11dGF0aW9uKHVwZGF0ZUNvbW1lbnQpCgogICAgY29uc3QgaGFuZGxlQ29tbWVudENyZWF0ZSA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKGlzV29ya2luZy52YWx1ZSkgcmV0dXJuCiAgICAgIHRyeSB7CiAgICAgICAgaXNXb3JraW5nLnZhbHVlID0gdHJ1ZQogICAgICAgIGNvbnN0IGNvbW1lbnQgPSB7CiAgICAgICAgICBib2R5OiBuZXdDb21tZW50LnZhbHVlLAogICAgICAgICAgd29ya29yZGVySWQ6IHByb3BzLmNvbW1lbnQud29ya29yZGVySWQsCiAgICAgICAgICB1c2VySWQ6IHByb3BzLmNvbW1lbnQudXNlci5pZAogICAgICAgIH0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKICAgICAgICBhd2FpdCBjcmVhdGVNdXRhdGlvbih7IGNvbW1lbnQgfSBhcyBhbnkpCiAgICAgICAgYXdhaXQgcHJvcHMucmVmZXRjaHdvcmtvcmRlcigpCiAgICAgICAgbmV3Q29tbWVudC52YWx1ZSA9ICcnCiAgICAgICAgaXNGb3JtT3Blbi52YWx1ZSA9IGZhbHNlCiAgICAgICAgaXNXb3JraW5nLnZhbHVlID0gZmFsc2UKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKQogICAgICAgIC8vIHJvb3QuJHZUb2FzdGlmeSgnRXJyb3InLCB7CiAgICAgICAgLy8gICB0eXBlOiAnZXJyb3InLAogICAgICAgIC8vICAgdGltZW91dDogMjUwMAogICAgICAgIC8vIH0pCiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBoYW5kbGVDb21tZW50VXBkYXRlID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoaXNXb3JraW5nLnZhbHVlKSByZXR1cm4KICAgICAgdHJ5IHsKICAgICAgICBpc1dvcmtpbmcudmFsdWUgPSB0cnVlCiAgICAgICAgY29uc3QgY29tbWVudCA9IHsKICAgICAgICAgIGJvZHk6IG5ld0NvbW1lbnQudmFsdWUsCiAgICAgICAgICB3b3Jrb3JkZXJJZDogcHJvcHMuY29tbWVudC53b3Jrb3JkZXJJZCwKICAgICAgICAgIHVzZXJJZDogcHJvcHMuY29tbWVudC51c2VyLmlkCiAgICAgICAgfQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQogICAgICAgIGF3YWl0IHVwZGF0ZU11dGF0aW9uKHsgY29tbWVudCwgY29tbWVudElkOiBwcm9wcy5jb21tZW50LmlkIH0gYXMgYW55KQogICAgICAgIGF3YWl0IHByb3BzLnJlZmV0Y2h3b3Jrb3JkZXIoKQogICAgICAgIGlzRm9ybU9wZW4udmFsdWUgPSBmYWxzZQogICAgICAgIGlzV29ya2luZy52YWx1ZSA9IGZhbHNlCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcikKICAgICAgICAvLyByb290LiR0b2FzdCgnRXJyb3InLCB7CiAgICAgICAgLy8gICB0eXBlOiAnZXJyb3InLAogICAgICAgIC8vICAgdGltZW91dDogMjUwMAogICAgICAgIC8vIH0pCiAgICAgIH0KICAgIH0KCiAgICBjb25zdCB0cmlnZ2VyQ29tbWVudERlbGV0ZSA9ICgpID0+IHsKICAgICAgZW1pdCgnZGVsZXRlJywgcHJvcHMuY29tbWVudC5pZCkKICAgIH0KCiAgICBjb25zdCBoYW5kbGVTdWJtaXQgPSAoKSA9PiB7CiAgICAgIHByb3BzLmlzQ3JlYXRlID8gaGFuZGxlQ29tbWVudENyZWF0ZSgpIDogaGFuZGxlQ29tbWVudFVwZGF0ZSgpCiAgICB9CiAgICBjb25zdCBoYW5kbGVLZXlEb3duID0gKGU6IEtleWJvYXJkRXZlbnQpID0+IHsKICAgICAgaWYgKGUua2V5Q29kZSA9PSAxMyAmJiAhZS5zaGlmdEtleSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKQogICAgICAgIGhhbmRsZVN1Ym1pdCgpCiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGhhbmRsZUNhbmNlbCA9ICgpID0+IHsKICAgICAgaXNGb3JtT3Blbi52YWx1ZSA9IGZhbHNlCiAgICB9CgogICAgY29uc3QgY3JlYXRlZEF0ID0gY29tcHV0ZWQoKCkgPT4KICAgICAgZm9ybWF0RGF0ZVRpbWVDb252ZXJzYXRpb25hbChwcm9wcy5jb21tZW50LmNyZWF0ZWRBdCkKICAgICkKCiAgICBjb25zdCBoYW5kbGVGYWtlVGV4dGFyZWFDbGlja2VkID0gKCkgPT4gewogICAgICBpZiAocHJvcHMuaXNDcmVhdGUpIHsKICAgICAgICBpc0Zvcm1PcGVuLnZhbHVlID0gdHJ1ZQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgY3JlYXRlZEF0LAogICAgICByZWFkT25seSwKICAgICAgbmV3Q29tbWVudCwKICAgICAgaXNXb3JraW5nLAogICAgICBpc0NvbW1lbnREZWxldGVDb25maXJtT3BlbiwKICAgICAgaXNGb3JtT3BlbiwKICAgICAgdHJpZ2dlckNvbW1lbnREZWxldGUsCiAgICAgIGhhbmRsZVN1Ym1pdCwKICAgICAgaGFuZGxlS2V5RG93biwKICAgICAgaGFuZGxlQ2FuY2VsLAogICAgICBoYW5kbGVGYWtlVGV4dGFyZWFDbGlja2VkLAogICAgICBoYW5kbGVDb21tZW50VXBkYXRlCiAgICB9CiAgfQp9KQo="},{"version":3,"sources":["Comment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6EA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Comment.vue","sourceRoot":"src/components/Project/Workorder/WorkorderDetails","sourcesContent":["<template>\n  <div class=\"relative mt-6 text-15\">\n    <!-- user-avatar -->\n    <j-avatar\n      class=\"absolute top-0 left-0\"\n      :name=\"comment.user.name\"\n      :avatarUrl=\"comment.user.avatarUrl\"\n    />\n    <!-- content -->\n    <div class=\"pl-10\">\n      <!-- username -->\n      <div\n        v-if=\"!isCreate\"\n        v-text=\"comment.user.name\"\n        class=\"inline-block mr-3 mb-2 text-textDark font-medium\"\n      />\n      <!-- createdAt -->\n      <div\n        v-if=\"!isCreate\"\n        v-text=\"createdAt\"\n        class=\"inline-block pb-2 text-textDark text-sm\"\n      />\n      <!-- body-form -->\n      <div v-if=\"isFormOpen\">\n        <j-textarea\n          v-model=\"newComment\"\n          autoFocus\n          rows=\"2\"\n          @keydown=\"handleKeyDown\"\n          placeholder=\"Add a comment...\"\n        />\n        <div class=\"flex pt-2 items-center\">\n          <j-button\n            class=\"mr-2\"\n            variant=\"primary\"\n            type=\"submit\"\n            @click=\"handleSubmit\"\n            :isWorking=\"isWorking\"\n          >\n            Save\n          </j-button>\n          <j-button variant=\"empty\" @click=\"handleCancel\">\n            Cancel\n          </j-button>\n        </div>\n      </div>\n      <div v-else>\n        <!-- comment-body -->\n        <p\n          v-if=\"isCreate\"\n          @click=\"isFormOpen = true\"\n          class=\"fakeTa pb-2 whitespace-pre-wrap\"\n        >\n          Add a comment...\n        </p>\n        <p v-else v-text=\"comment.body\" class=\"pb-2 whitespace-pre-wrap\"></p>\n        <!-- edit-link -->\n        <div v-if=\"!isCreate && !readOnly\">\n          <div\n            @click=\"isFormOpen = true\"\n            class=\"mr-3 inline-block py-1 text-textMedium text-sm cursor-pointer select-none hover:underline\"\n          >\n            Edit\n          </div>\n          <div\n            @click=\"triggerCommentDelete\"\n            class=\"mr-3 inline-block py-1 text-textMedium text-sm cursor-pointer select-none hover:underline\"\n          >\n            Delete\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, ref } from '@vue/composition-api'\n\nimport { Comment } from '@/types/comment'\nimport { formatDateTimeConversational } from '@/utils/date'\nimport { useMutation } from '@vue/apollo-composable'\nimport { createComment, updateComment } from '@/graphql/queries/comment'\nimport { getters } from '@/store'\n\nexport default defineComponent({\n  props: {\n    comment: {\n      type: Object as () => Comment,\n      required: true\n    },\n    isCreate: {\n      type: Boolean,\n      default: false\n    },\n    refetchworkorder: {\n      type: Function,\n      required: true\n    }\n  },\n  setup(props, { root, emit }) {\n    const currentUser = computed(getters.currentUser)\n    const newComment = ref<string>(props.isCreate ? '' : props.comment.body)\n    const isWorking = ref<boolean>(false)\n    const isFormOpen = ref<boolean>(false)\n    const isCommentDeleteConfirmOpen = ref<boolean>(false)\n    const readOnly = computed(\n      () => currentUser.value.id != props.comment.userId\n    )\n\n    const { mutate: createMutation } = useMutation(createComment)\n    const { mutate: updateMutation } = useMutation(updateComment)\n\n    const handleCommentCreate = async () => {\n      if (isWorking.value) return\n      try {\n        isWorking.value = true\n        const comment = {\n          body: newComment.value,\n          workorderId: props.comment.workorderId,\n          userId: props.comment.user.id\n        }\n        // eslint-disable-next-line\n        await createMutation({ comment } as any)\n        await props.refetchworkorder()\n        newComment.value = ''\n        isFormOpen.value = false\n        isWorking.value = false\n      } catch (error) {\n        console.error(error)\n        // root.$vToastify('Error', {\n        //   type: 'error',\n        //   timeout: 2500\n        // })\n      }\n    }\n\n    const handleCommentUpdate = async () => {\n      if (isWorking.value) return\n      try {\n        isWorking.value = true\n        const comment = {\n          body: newComment.value,\n          workorderId: props.comment.workorderId,\n          userId: props.comment.user.id\n        }\n        // eslint-disable-next-line\n        await updateMutation({ comment, commentId: props.comment.id } as any)\n        await props.refetchworkorder()\n        isFormOpen.value = false\n        isWorking.value = false\n      } catch (error) {\n        console.error(error)\n        // root.$toast('Error', {\n        //   type: 'error',\n        //   timeout: 2500\n        // })\n      }\n    }\n\n    const triggerCommentDelete = () => {\n      emit('delete', props.comment.id)\n    }\n\n    const handleSubmit = () => {\n      props.isCreate ? handleCommentCreate() : handleCommentUpdate()\n    }\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.keyCode == 13 && !e.shiftKey) {\n        e.preventDefault()\n        handleSubmit()\n      }\n    }\n    const handleCancel = () => {\n      isFormOpen.value = false\n    }\n\n    const createdAt = computed(() =>\n      formatDateTimeConversational(props.comment.createdAt)\n    )\n\n    const handleFakeTextareaClicked = () => {\n      if (props.isCreate) {\n        isFormOpen.value = true\n      }\n    }\n\n    return {\n      createdAt,\n      readOnly,\n      newComment,\n      isWorking,\n      isCommentDeleteConfirmOpen,\n      isFormOpen,\n      triggerCommentDelete,\n      handleSubmit,\n      handleKeyDown,\n      handleCancel,\n      handleFakeTextareaClicked,\n      handleCommentUpdate\n    }\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.fakeTa {\n  color: rgb(137, 147, 164);\n  border: 1px solid rgb(223, 225, 230);\n  cursor: text;\n  user-select: none;\n  padding: 12px 16px;\n  border-radius: 4px;\n}\n</style>\n"]}]}