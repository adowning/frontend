{"remainingRequest":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Lists/Lists.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Lists/Lists.vue","mtime":1601935109868},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCmltcG9ydCB7IGRlZmluZUNvbXBvbmVudCwgY29tcHV0ZWQsIHJlZiB9IGZyb20gJ0B2dWUvY29tcG9zaXRpb24tYXBpJwppbXBvcnQgTGlzdCBmcm9tICdAL2NvbXBvbmVudHMvUHJvamVjdC9MaXN0cy9MaXN0LnZ1ZScKaW1wb3J0IHsgV29ya29yZGVyU3RhdHVzIH0gZnJvbSAnQC90eXBlcy93b3Jrb3JkZXInCmltcG9ydCB7IGdldHRlcnMsIG11dGF0aW9ucyB9IGZyb20gJ0Avc3RvcmUnCmltcG9ydCB7CiAgRHJvcFJlc3VsdCwKICBUYXJnZXQsCiAgY2FsY3VsYXRlV29ya29yZGVyTGlzdFBvc2l0aW9uLAogIGlzUG9zaXRpb25DaGFuZ2VkLAogIHVwZGF0ZUFycmF5SXRlbUJ5SWQKfSBmcm9tICdAL3V0aWxzL2RuZCcKaW1wb3J0IHsgdXNlTXV0YXRpb24gfSBmcm9tICdAdnVlL2Fwb2xsby1jb21wb3NhYmxlJwppbXBvcnQgeyB1cGRhdGVXb3Jrb3JkZXJNdXRhdGlvbiB9IGZyb20gJ0AvZ3JhcGhxbC9xdWVyaWVzL3dvcmtvcmRlcicKCmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7CiAgY29tcG9uZW50czogewogICAgTGlzdAogIH0sCiAgc2V0dXAoKSB7CiAgICBjb25zdCBwcm9qZWN0ID0gY29tcHV0ZWQoZ2V0dGVycy5wcm9qZWN0KQogICAgY29uc3QgZGVzdGluYXRpb24gPSByZWY8VGFyZ2V0PihudWxsKQogICAgY29uc3Qgc291cmNlID0gcmVmPFRhcmdldD4obnVsbCkKCiAgICBjb25zdCB7IG11dGF0ZSB9ID0gdXNlTXV0YXRpb24odXBkYXRlV29ya29yZGVyTXV0YXRpb24pCgogICAgY29uc3QgaGFuZGxlV29ya29yZGVyRHJvcCA9ICh3b3Jrb3JkZXJJZDogc3RyaW5nLCBkOiBUYXJnZXQsIHM6IFRhcmdldCkgPT4gewogICAgICBpZiAoIWlzUG9zaXRpb25DaGFuZ2VkKHMsIGQpKSByZXR1cm4KCiAgICAgIGNvbnN0IHdvcmtvcmRlclVwZGF0ZVZhbHVlcyA9IHsKICAgICAgICBzdGF0dXM6IGQuZHJvcHBhYmxlSWQsCiAgICAgICAgbGlzdFBvc2l0aW9uOiBjYWxjdWxhdGVXb3Jrb3JkZXJMaXN0UG9zaXRpb24oCiAgICAgICAgICBwcm9qZWN0LnZhbHVlLndvcmtvcmRlcnMsCiAgICAgICAgICBkLAogICAgICAgICAgcywKICAgICAgICAgIHdvcmtvcmRlcklkCiAgICAgICAgKQogICAgICB9CgogICAgICBjb25zdCB3b3Jrb3JkZXJzID0gdXBkYXRlQXJyYXlJdGVtQnlJZCgKICAgICAgICBwcm9qZWN0LnZhbHVlLndvcmtvcmRlcnMsCiAgICAgICAgd29ya29yZGVySWQsCiAgICAgICAgd29ya29yZGVyVXBkYXRlVmFsdWVzCiAgICAgICkKCiAgICAgIGNvbnN0IG9sZFByb2plY3RWYWx1ZXMgPSBnZXR0ZXJzLnByb2plY3QoKQogICAgICAvLyBvcHRpbWlzdGljIHVwZGF0ZQogICAgICBtdXRhdGlvbnMuc2V0UHJvamVjdCh7CiAgICAgICAgLi4ucHJvamVjdC52YWx1ZSwKICAgICAgICB3b3Jrb3JkZXJzCiAgICAgIH0pCgogICAgICBtdXRhdGUoewogICAgICAgIHdvcmtvcmRlcklkOiBOdW1iZXIod29ya29yZGVySWQpLAogICAgICAgIFdvcmtvcmRlcjogd29ya29yZGVyVXBkYXRlVmFsdWVzCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgIH0gYXMgYW55KS5jYXRjaChlID0+IHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpCiAgICAgICAgbXV0YXRpb25zLnNldFByb2plY3Qob2xkUHJvamVjdFZhbHVlcykKICAgICAgfSkKICAgICAgZGVzdGluYXRpb24udmFsdWUgPSBudWxsCiAgICAgIHNvdXJjZS52YWx1ZSA9IG51bGwKICAgIH0KCiAgICBjb25zdCBvbkRyb3AgPSAoZHJvcFJlc3VsdDogRHJvcFJlc3VsdCkgPT4gewogICAgICBjb25zdCB7IHJlbW92ZWRJbmRleCwgYWRkZWRJbmRleCwgcGF5bG9hZCwgdG8gfSA9IGRyb3BSZXN1bHQKCiAgICAgIGlmIChyZW1vdmVkSW5kZXggPT0gbnVsbCAmJiBhZGRlZEluZGV4ID09IG51bGwpIHJldHVybgoKICAgICAgaWYgKHJlbW92ZWRJbmRleCAhPSBudWxsKSB7CiAgICAgICAgc291cmNlLnZhbHVlID0gewogICAgICAgICAgaW5kZXg6IHJlbW92ZWRJbmRleCwKICAgICAgICAgIGRyb3BwYWJsZUlkOiBwYXlsb2FkLnN0YXR1cwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGFkZGVkSW5kZXggIT0gbnVsbCkgewogICAgICAgIGRlc3RpbmF0aW9uLnZhbHVlID0gewogICAgICAgICAgaW5kZXg6IGFkZGVkSW5kZXgsCiAgICAgICAgICBkcm9wcGFibGVJZDogT2JqZWN0LnZhbHVlcyhXb3Jrb3JkZXJTdGF0dXMpW3RvXQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGRlc3RpbmF0aW9uLnZhbHVlICE9IG51bGwgJiYgc291cmNlLnZhbHVlICE9IG51bGwpIHsKICAgICAgICBoYW5kbGVXb3Jrb3JkZXJEcm9wKHBheWxvYWQuaWQsIGRlc3RpbmF0aW9uLnZhbHVlLCBzb3VyY2UudmFsdWUpCiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBvbkRyb3AsCiAgICAgIFdvcmtvcmRlclN0YXR1cwogICAgfQogIH0KfSkK"},{"version":3,"sources":["Lists.vue"],"names":[],"mappings":";;;;;;;;;;;;;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"Lists.vue","sourceRoot":"src/components/Project/Lists","sourcesContent":["<template>\n  <div class=\"flex container mt-7\">\n    <List\n      @drop=\"onDrop\"\n      v-for=\"status in WorkorderStatus\"\n      :key=\"status\"\n      :status=\"status\"\n    >\n    </List>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, ref } from '@vue/composition-api'\nimport List from '@/components/Project/Lists/List.vue'\nimport { WorkorderStatus } from '@/types/workorder'\nimport { getters, mutations } from '@/store'\nimport {\n  DropResult,\n  Target,\n  calculateWorkorderListPosition,\n  isPositionChanged,\n  updateArrayItemById\n} from '@/utils/dnd'\nimport { useMutation } from '@vue/apollo-composable'\nimport { updateWorkorderMutation } from '@/graphql/queries/workorder'\n\nexport default defineComponent({\n  components: {\n    List\n  },\n  setup() {\n    const project = computed(getters.project)\n    const destination = ref<Target>(null)\n    const source = ref<Target>(null)\n\n    const { mutate } = useMutation(updateWorkorderMutation)\n\n    const handleWorkorderDrop = (workorderId: string, d: Target, s: Target) => {\n      if (!isPositionChanged(s, d)) return\n\n      const workorderUpdateValues = {\n        status: d.droppableId,\n        listPosition: calculateWorkorderListPosition(\n          project.value.workorders,\n          d,\n          s,\n          workorderId\n        )\n      }\n\n      const workorders = updateArrayItemById(\n        project.value.workorders,\n        workorderId,\n        workorderUpdateValues\n      )\n\n      const oldProjectValues = getters.project()\n      // optimistic update\n      mutations.setProject({\n        ...project.value,\n        workorders\n      })\n\n      mutate({\n        workorderId: Number(workorderId),\n        Workorder: workorderUpdateValues\n        // eslint-disable-next-line\n      } as any).catch(e => {\n        console.error(e)\n        mutations.setProject(oldProjectValues)\n      })\n      destination.value = null\n      source.value = null\n    }\n\n    const onDrop = (dropResult: DropResult) => {\n      const { removedIndex, addedIndex, payload, to } = dropResult\n\n      if (removedIndex == null && addedIndex == null) return\n\n      if (removedIndex != null) {\n        source.value = {\n          index: removedIndex,\n          droppableId: payload.status\n        }\n      }\n\n      if (addedIndex != null) {\n        destination.value = {\n          index: addedIndex,\n          droppableId: Object.values(WorkorderStatus)[to]\n        }\n      }\n\n      if (destination.value != null && source.value != null) {\n        handleWorkorderDrop(payload.id, destination.value, source.value)\n      }\n    }\n\n    return {\n      onDrop,\n      WorkorderStatus\n    }\n  }\n})\n</script>\n"]}]}