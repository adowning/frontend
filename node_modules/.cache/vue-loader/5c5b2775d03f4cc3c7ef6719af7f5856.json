{"remainingRequest":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Workorder/WorkorderDetails/Comment.vue?vue&type=style&index=0&id=2823b46d&lang=scss&scoped=true&","dependencies":[{"path":"/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Workorder/WorkorderDetails/Comment.vue","mtime":1601934218213},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZmFrZVRhIHsKICBjb2xvcjogcmdiKDEzNywgMTQ3LCAxNjQpOwogIGJvcmRlcjogMXB4IHNvbGlkIHJnYigyMjMsIDIyNSwgMjMwKTsKICBjdXJzb3I6IHRleHQ7CiAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgcGFkZGluZzogMTJweCAxNnB4OwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQo="},{"version":3,"sources":["Comment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Comment.vue","sourceRoot":"src/components/Project/Workorder/WorkorderDetails","sourcesContent":["<template>\n  <div class=\"relative mt-6 text-15\">\n    <!-- user-avatar -->\n    <j-avatar\n      class=\"absolute top-0 left-0\"\n      :name=\"comment.user.name\"\n      :avatarUrl=\"comment.user.avatarUrl\"\n    />\n    <!-- content -->\n    <div class=\"pl-10\">\n      <!-- username -->\n      <div\n        v-if=\"!isCreate\"\n        v-text=\"comment.user.name\"\n        class=\"inline-block mr-3 mb-2 text-textDark font-medium\"\n      />\n      <!-- createdAt -->\n      <div\n        v-if=\"!isCreate\"\n        v-text=\"createdAt\"\n        class=\"inline-block pb-2 text-textDark text-sm\"\n      />\n      <!-- body-form -->\n      <div v-if=\"isFormOpen\">\n        <j-textarea\n          v-model=\"newComment\"\n          autoFocus\n          rows=\"2\"\n          @keydown=\"handleKeyDown\"\n          placeholder=\"Add a comment...\"\n        />\n        <div class=\"flex pt-2 items-center\">\n          <j-button\n            class=\"mr-2\"\n            variant=\"primary\"\n            type=\"submit\"\n            @click=\"handleSubmit\"\n            :isWorking=\"isWorking\"\n          >\n            Save\n          </j-button>\n          <j-button variant=\"empty\" @click=\"handleCancel\">\n            Cancel\n          </j-button>\n        </div>\n      </div>\n      <div v-else>\n        <!-- comment-body -->\n        <p\n          v-if=\"isCreate\"\n          @click=\"isFormOpen = true\"\n          class=\"fakeTa pb-2 whitespace-pre-wrap\"\n        >\n          Add a comment...\n        </p>\n        <p v-else v-text=\"comment.body\" class=\"pb-2 whitespace-pre-wrap\"></p>\n        <!-- edit-link -->\n        <div v-if=\"!isCreate && !readOnly\">\n          <div\n            @click=\"isFormOpen = true\"\n            class=\"mr-3 inline-block py-1 text-textMedium text-sm cursor-pointer select-none hover:underline\"\n          >\n            Edit\n          </div>\n          <div\n            @click=\"triggerCommentDelete\"\n            class=\"mr-3 inline-block py-1 text-textMedium text-sm cursor-pointer select-none hover:underline\"\n          >\n            Delete\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, ref } from '@vue/composition-api'\n\nimport { Comment } from '@/types/comment'\nimport { formatDateTimeConversational } from '@/utils/date'\nimport { useMutation } from '@vue/apollo-composable'\nimport { createComment, updateComment } from '@/graphql/queries/comment'\nimport { getters } from '@/store'\n\nexport default defineComponent({\n  props: {\n    comment: {\n      type: Object as () => Comment,\n      required: true\n    },\n    isCreate: {\n      type: Boolean,\n      default: false\n    },\n    refetchworkorder: {\n      type: Function,\n      required: true\n    }\n  },\n  setup(props, { root, emit }) {\n    const currentUser = computed(getters.currentUser)\n    const newComment = ref<string>(props.isCreate ? '' : props.comment.body)\n    const isWorking = ref<boolean>(false)\n    const isFormOpen = ref<boolean>(false)\n    const isCommentDeleteConfirmOpen = ref<boolean>(false)\n    const readOnly = computed(\n      () => currentUser.value.id != props.comment.userId\n    )\n\n    const { mutate: createMutation } = useMutation(createComment)\n    const { mutate: updateMutation } = useMutation(updateComment)\n\n    const handleCommentCreate = async () => {\n      if (isWorking.value) return\n      try {\n        isWorking.value = true\n        const comment = {\n          body: newComment.value,\n          workorderId: props.comment.workorderId,\n          userId: props.comment.user.id\n        }\n        // eslint-disable-next-line\n        await createMutation({ comment } as any)\n        await props.refetchworkorder()\n        newComment.value = ''\n        isFormOpen.value = false\n        isWorking.value = false\n      } catch (error) {\n        console.error(error)\n        // root.$vToastify('Error', {\n        //   type: 'error',\n        //   timeout: 2500\n        // })\n      }\n    }\n\n    const handleCommentUpdate = async () => {\n      if (isWorking.value) return\n      try {\n        isWorking.value = true\n        const comment = {\n          body: newComment.value,\n          workorderId: props.comment.workorderId,\n          userId: props.comment.user.id\n        }\n        // eslint-disable-next-line\n        await updateMutation({ comment, commentId: props.comment.id } as any)\n        await props.refetchworkorder()\n        isFormOpen.value = false\n        isWorking.value = false\n      } catch (error) {\n        console.error(error)\n        // root.$toast('Error', {\n        //   type: 'error',\n        //   timeout: 2500\n        // })\n      }\n    }\n\n    const triggerCommentDelete = () => {\n      emit('delete', props.comment.id)\n    }\n\n    const handleSubmit = () => {\n      props.isCreate ? handleCommentCreate() : handleCommentUpdate()\n    }\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.keyCode == 13 && !e.shiftKey) {\n        e.preventDefault()\n        handleSubmit()\n      }\n    }\n    const handleCancel = () => {\n      isFormOpen.value = false\n    }\n\n    const createdAt = computed(() =>\n      formatDateTimeConversational(props.comment.createdAt)\n    )\n\n    const handleFakeTextareaClicked = () => {\n      if (props.isCreate) {\n        isFormOpen.value = true\n      }\n    }\n\n    return {\n      createdAt,\n      readOnly,\n      newComment,\n      isWorking,\n      isCommentDeleteConfirmOpen,\n      isFormOpen,\n      triggerCommentDelete,\n      handleSubmit,\n      handleKeyDown,\n      handleCancel,\n      handleFakeTextareaClicked,\n      handleCommentUpdate\n    }\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.fakeTa {\n  color: rgb(137, 147, 164);\n  border: 1px solid rgb(223, 225, 230);\n  cursor: text;\n  user-select: none;\n  padding: 12px 16px;\n  border-radius: 4px;\n}\n</style>\n"]}]}