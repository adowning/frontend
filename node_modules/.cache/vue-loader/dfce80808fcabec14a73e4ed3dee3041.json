{"remainingRequest":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Workorder/WorkorderSearch/WorkorderSearch.vue?vue&type=script&lang=tsx&","dependencies":[{"path":"/home/ash/Documents/cloudrun/second/frontend/src/components/Project/Workorder/WorkorderSearch/WorkorderSearch.vue","mtime":1601935310559},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ash/Documents/cloudrun/second/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKaW1wb3J0IHsgZGVmaW5lQ29tcG9uZW50LCByZWYsIGNvbXB1dGVkLCBvbk1vdW50ZWQgfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaScKaW1wb3J0IFNlYXJjaFJlc3VsdCBmcm9tICcuL1NlYXJjaFJlc3VsdC52dWUnCmltcG9ydCBMb2FkZXIgZnJvbSAnQC9jb21wb25lbnRzL0xvYWRlci52dWUnCmltcG9ydCB7IHVzZVF1ZXJ5LCB1c2VSZXN1bHQgfSBmcm9tICdAdnVlL2Fwb2xsby1jb21wb3NhYmxlJwppbXBvcnQgeyBnZXRQcm9qZWN0V29ya29yZGVycyB9IGZyb20gJ0AvZ3JhcGhxbC9xdWVyaWVzL3dvcmtvcmRlcicKaW1wb3J0IHsgV29ya29yZGVyIH0gZnJvbSAnQC90eXBlcy93b3Jrb3JkZXInCmltcG9ydCB7IGdldHRlcnMgfSBmcm9tICdAL3N0b3JlJwppbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gJ3Rocm90dGxlLWRlYm91bmNlJwppbXBvcnQgeyBDb21iaW5lZFZ1ZUluc3RhbmNlIH0gZnJvbSAndnVlL3R5cGVzL3Z1ZScKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCmNvbnN0IHNvcnRCeU5ld2VzdCA9IChpdGVtczogYW55W10gPSBbXSwgc29ydEZpZWxkOiBzdHJpbmcpID0+CiAgaXRlbXMuc29ydCgoYSwgYikgPT4gLWFbc29ydEZpZWxkXS5sb2NhbGVDb21wYXJlKGJbc29ydEZpZWxkXSkpCgpleHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoewogIGNvbXBvbmVudHM6IHsKICAgIFNlYXJjaFJlc3VsdCwKICAgIFNwaW5uZXI6IExvYWRlcgogIH0sCiAgc2V0dXAoKSB7CiAgICBjb25zdCBpc1NlYXJjaFRlcm1FbXB0eSA9IHJlZjxib29sZWFuPih0cnVlKQogICAgY29uc3Qgc2VhcmNoVGVybSA9IHJlZjxzdHJpbmc+KCcnKQogICAgY29uc3Qgc2VhcmNoSW5wdXRSZWYgPSByZWY8CiAgICAgIENvbWJpbmVkVnVlSW5zdGFuY2U8VnVlLCBvYmplY3QsIG9iamVjdCwgb2JqZWN0LCBvYmplY3Q+CiAgICA+KG51bGwpCiAgICBjb25zdCB7IHJlc3VsdCwgcmVmZXRjaCwgbG9hZGluZyB9ID0gdXNlUXVlcnk8V29ya29yZGVyW10+KAogICAgICBnZXRQcm9qZWN0V29ya29yZGVycywKICAgICAgewogICAgICAgIHNlYXJjaFRlcm06IHNlYXJjaFRlcm0udmFsdWUKICAgICAgfQogICAgKQoKICAgIGNvbnN0IHByb2plY3QgPSBjb21wdXRlZChnZXR0ZXJzLnByb2plY3QpCgogICAgY29uc3QgbWF0Y2hpbmd3b3Jrb3JkZXJzID0gdXNlUmVzdWx0KHJlc3VsdCwgW10pCiAgICBjb25zdCByZWNlbnR3b3Jrb3JkZXJzID0gY29tcHV0ZWQoKCkgPT4KICAgICAgc29ydEJ5TmV3ZXN0KHByb2plY3QudmFsdWUud29ya29yZGVycywgJ2NyZWF0ZWRBdCcpLnNsaWNlKDAsIDEwKQogICAgKQoKICAgIGNvbnN0IGhhbmRsZVNlYXJjaENoYW5nZSA9IGRlYm91bmNlKDUwMCwgKHZhbHVlOiBzdHJpbmcpID0+IHsKICAgICAgc2VhcmNoVGVybS52YWx1ZSA9IHZhbHVlLnRyaW0oKQogICAgICBpc1NlYXJjaFRlcm1FbXB0eS52YWx1ZSA9ICFzZWFyY2hUZXJtLnZhbHVlCiAgICAgIGlmIChzZWFyY2hUZXJtLnZhbHVlKSB7CiAgICAgICAgcmVmZXRjaCh7IHNlYXJjaFRlcm06IHNlYXJjaFRlcm0udmFsdWUgfSkKICAgICAgfQogICAgfSkKCiAgICBvbk1vdW50ZWQoKCkgPT4gewogICAgICBpZiAoc2VhcmNoSW5wdXRSZWYudmFsdWUpIHsKICAgICAgICBjb25zdCBpbnB1dEVsID0gc2VhcmNoSW5wdXRSZWYudmFsdWUuJGVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykKICAgICAgICBpZiAoaW5wdXRFbCkgewogICAgICAgICAgaW5wdXRFbC5mb2N1cygpCiAgICAgICAgfQogICAgICB9CiAgICB9KQoKICAgIHJldHVybiB7CiAgICAgIG1hdGNoaW5nd29ya29yZGVycywKICAgICAgbG9hZGluZywKICAgICAgcmVjZW50d29ya29yZGVycywKICAgICAgaXNTZWFyY2hUZXJtRW1wdHksCiAgICAgIGhhbmRsZVNlYXJjaENoYW5nZSwKICAgICAgc2VhcmNoVGVybSwKICAgICAgc2VhcmNoSW5wdXRSZWYKICAgIH0KICB9Cn0pCg=="},{"version":3,"sources":["WorkorderSearch.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"WorkorderSearch.vue","sourceRoot":"src/components/Project/Workorder/WorkorderSearch","sourcesContent":["<template>\n  <div class=\"px-8 pb-16 pt-6\">\n    <div class=\"relative pr-7 mb-10\">\n      <j-input\n        ref=\"searchInputRef\"\n        class=\"flat text-textMedium\"\n        icon=\"search\"\n        @input=\"handleSearchChange\"\n        :value=\"searchTerm\"\n        :iconSize=\"26\"\n        placeholder=\"Search workorders by summary, description...\"\n      />\n    </div>\n    <div\n      class=\"pt-10 flex flex-col justify-center items-center\"\n      v-if=\"loading && !isSearchTermEmpty\"\n    >\n      <Spinner />\n    </div>\n    <div class=\"fadeIn\" v-else>\n      <div v-if=\"isSearchTermEmpty && recentworkorders.length > 0\">\n        <div class=\"sectionTitle\">Recent workorders</div>\n        <SearchResult\n          v-for=\"workorder in recentworkorders\"\n          :key=\"workorder.id\"\n          :workorder=\"workorder\"\n        />\n      </div>\n      <div v-if=\"!isSearchTermEmpty && matchingworkorders.length > 0\">\n        <div class=\"sectionTitle\">Matching workorders</div>\n        <SearchResult\n          v-for=\"workorder in matchingworkorders\"\n          :key=\"workorder.id\"\n          :workorder=\"workorder\"\n        />\n      </div>\n      <div\n        class=\"pt-10 flex flex-col justify-center items-center\"\n        v-if=\"!isSearchTermEmpty && !loading && matchingworkorders.length === 0\"\n      >\n        <j-icon :size=\"125\" name=\"no-result\"></j-icon>\n        <div class=\"pt-8 font-medium text-xl\">\n          We couldn&apos;t find anything matching your search\n        </div>\n        <div class=\"pt-2 text-15\">Try again with a different term.</div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"tsx\">\nimport { defineComponent, ref, computed, onMounted } from '@vue/composition-api'\nimport SearchResult from './SearchResult.vue'\nimport Loader from '@/components/Loader.vue'\nimport { useQuery, useResult } from '@vue/apollo-composable'\nimport { getProjectWorkorders } from '@/graphql/queries/workorder'\nimport { Workorder } from '@/types/workorder'\nimport { getters } from '@/store'\nimport { debounce } from 'throttle-debounce'\nimport { CombinedVueInstance } from 'vue/types/vue'\n// eslint-disable-next-line\nconst sortByNewest = (items: any[] = [], sortField: string) =>\n  items.sort((a, b) => -a[sortField].localeCompare(b[sortField]))\n\nexport default defineComponent({\n  components: {\n    SearchResult,\n    Spinner: Loader\n  },\n  setup() {\n    const isSearchTermEmpty = ref<boolean>(true)\n    const searchTerm = ref<string>('')\n    const searchInputRef = ref<\n      CombinedVueInstance<Vue, object, object, object, object>\n    >(null)\n    const { result, refetch, loading } = useQuery<Workorder[]>(\n      getProjectWorkorders,\n      {\n        searchTerm: searchTerm.value\n      }\n    )\n\n    const project = computed(getters.project)\n\n    const matchingworkorders = useResult(result, [])\n    const recentworkorders = computed(() =>\n      sortByNewest(project.value.workorders, 'createdAt').slice(0, 10)\n    )\n\n    const handleSearchChange = debounce(500, (value: string) => {\n      searchTerm.value = value.trim()\n      isSearchTermEmpty.value = !searchTerm.value\n      if (searchTerm.value) {\n        refetch({ searchTerm: searchTerm.value })\n      }\n    })\n\n    onMounted(() => {\n      if (searchInputRef.value) {\n        const inputEl = searchInputRef.value.$el.querySelector('input')\n        if (inputEl) {\n          inputEl.focus()\n        }\n      }\n    })\n\n    return {\n      matchingworkorders,\n      loading,\n      recentworkorders,\n      isSearchTermEmpty,\n      handleSearchChange,\n      searchTerm,\n      searchInputRef\n    }\n  }\n})\n</script>\n\n<style lang=\"postcss\" scoped>\n.sectionTitle {\n  @apply text-textMedium font-bold text-xs uppercase pb-3;\n}\n</style>\n\n<style lang=\"scss\"></style>\n"]}]}